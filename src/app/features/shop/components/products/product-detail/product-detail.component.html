<div class="product-detail-container" *ngIf="!loading && product; else loadingTemplate">
  <div class="product-gallery">
    <div class="main-image">
      <img [src]="product.imgUrls?.[selectedImageIndex] || 'assets/placeholder-image.jpg'" [alt]="product.title">
    </div>
    <div class="thumbnail-carousel" *ngIf="product.imgUrls && product.imgUrls.length > 0">
      <div 
        *ngFor="let img of product.imgUrls; let i = index" 
        class="thumbnail" 
        [class.active]="selectedImageIndex === i"
        (click)="selectImage(i)"
      >
        <img [src]="img" [alt]="product.title + ' thumbnail ' + (i+1)">
      </div>
    </div>
  </div>

  <div class="product-info">
    <div class="product-header">
      <div class="hd-badge" *ngIf="product.productType">{{getProductTypeName(product.productType)}}</div>
      <div class="price-section">
        <div class="price-container">
          <span class="current-price" *ngIf="product.variants && product.variants.length > 0">
            LKR{{(product.variants[0]?.price || 0).toFixed(2)}}
          </span>
        </div>
        <div class="tax-info">Tax excluded, add at checkout if applicable : Extra 2% off with coins</div>
      </div>
    </div>

    <h1 class="product-title">{{product.title}}</h1>
    <p class="product-description">{{product.description}}</p>

    <div class="return-policy">
      <div class="policy-item">
        <i class="fas fa-exchange-alt"></i>
        <span>Return&refund policy</span>
        <i class="fas fa-chevron-right"></i>
      </div>
      <div class="policy-item">
        <i class="fas fa-shield-alt"></i>
        <span>Security & Privacy</span>
        <i class="fas fa-chevron-right"></i>
      </div>
    </div>

    <!-- Tags Section -->
    <div class="tags-section" *ngIf="product.tags && product.tags.length > 0">
      <h3>Tags</h3>
      <div class="tags-list">
        <span class="tag" *ngFor="let tag of product.tags">{{tag}}</span>
      </div>
    </div>

    <div class="quantity-section">
      <h3>Quantity</h3>
      <div class="quantity-control">
        <button class="quantity-btn" (click)="decreaseQuantity()">-</button>
        <span class="quantity-value">{{quantity}}</span>
        <button class="quantity-btn" (click)="increaseQuantity()">+</button>
      </div>
      <div class="max-quantity" *ngIf="product.variants && product.variants.length > 0">
        {{product.variants[0]?.availableQuantity || 0}} available
      </div>
    </div>

    <div class="action-buttons">
      <button class="buy-now-btn" (click)="buyNow()">Buy now</button>
      <button class="add-to-cart-btn" (click)="addToCart()">Add to cart</button>
    </div>

    <div class="social-actions">
      <button class="share-btn">
        <i class="fas fa-share-alt"></i>
        <span>Share</span>
      </button>
      <button class="wishlist-btn">
        <i class="far fa-heart"></i>
        <span>Add to wishlist</span>
      </button>
    </div>
  </div>
</div>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading product details...</p>
  </div>
  
  <div class="error-container" *ngIf="error">
    <div class="error-icon">
      <i class="fas fa-exclamation-circle"></i>
    </div>
    <h2>Oops! Something went wrong</h2>
    <p>We couldn't load the product details. Please try again later.</p>
    <button class="retry-btn" (click)="loadProductDetails(productId || '')">Retry</button>
  </div>
</ng-template>

<!-- Customer Reviews Section -->
<div class="reviews-container">
  <div class="reviews-header">
    <h2>Customer Reviews</h2>
    <div class="overall-rating">
      <div class="rating-number">4.9</div>
      <div class="stars">
        <i class="fas fa-star"></i>
        <i class="fas fa-star"></i>
        <i class="fas fa-star"></i>
        <i class="fas fa-star"></i>
        <i class="fas fa-star-half-alt"></i>
      </div>
      <div class="total-reviews">74 reviews</div>
    </div>
  </div>

  <div class="reviews-filter">
    <div class="filter-heading">Filter Reviews</div>
    <div class="rating-filter">
      <button class="filter-btn active">All</button>
      <button class="filter-btn">5 Stars</button>
      <button class="filter-btn">4 Stars</button>
      <button class="filter-btn">3 Stars</button>
      <button class="filter-btn">2 Stars</button>
      <button class="filter-btn">1 Star</button>
    </div>
  </div>

  <div class="reviews-list">
    <!-- Review 1 -->
    <div class="review-item">
      <div class="reviewer-info">
        <div class="avatar">JD</div>
        <div class="name-date">
          <div class="reviewer-name">John Doe</div>
          <div class="review-date">April 12, 2023</div>
        </div>
      </div>
      <div class="review-rating">
        <div class="stars">
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
        </div>
      </div>
      <div class="review-content">
        <p>Great drone for the price! The camera quality is excellent, and it's very easy to fly. Battery life is decent - got about 15 minutes of flight time. The app is a bit buggy but works fine most of the time.</p>
      </div>
      <div class="review-photos">
        <img src="https://ae01.alicdn.com/kf/S661f3b6c7fa24798b56a726f4ffd0fddp/V8-New-Mini-Drone-4k-profession-HD-1080P-Wide-Angle-Camera-WiFi-FPV-RC-Dron-Height.jpg_Q90.jpg" alt="User photo 1">
        <img src="https://ae01.alicdn.com/kf/S30f4e0adecdf43efb67e84ec4725de9fa/V8-New-Mini-Drone-4k-profession-HD-1080P-Wide-Angle-Camera-WiFi-FPV-RC-Dron-Height.jpg_Q90.jpg" alt="User photo 2">
      </div>
    </div>

    <!-- Review 2 -->
    <div class="review-item">
      <div class="reviewer-info">
        <div class="avatar">MS</div>
        <div class="name-date">
          <div class="reviewer-name">Marie Smith</div>
          <div class="review-date">March 28, 2023</div>
        </div>
      </div>
      <div class="review-rating">
        <div class="stars">
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="far fa-star"></i>
        </div>
      </div>
      <div class="review-content">
        <p>Bought this for my son and he loves it. It's very durable - has survived multiple crashes already. The controls are intuitive enough for a beginner. My only complaint is the battery life could be better, but for the price, it's fantastic.</p>
      </div>
    </div>

    <!-- Review 3 -->
    <div class="review-item">
      <div class="reviewer-info">
        <div class="avatar">RJ</div>
        <div class="name-date">
          <div class="reviewer-name">Robert Jones</div>
          <div class="review-date">February 15, 2023</div>
        </div>
      </div>
      <div class="review-rating">
        <div class="stars">
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
          <i class="fas fa-star"></i>
        </div>
      </div>
      <div class="review-content">
        <p>This is my third drone and by far the best value for money. The 4K camera captures amazing footage, and the flight stability is impressive for such a small drone. Highly recommended for both beginners and experienced users.</p>
      </div>
      <div class="review-photos">
        <img src="https://ae01.alicdn.com/kf/Seccb32238fc84517baf316cc1fdf13c8M/V8-New-Mini-Drone-4k-profession-HD-1080P-Wide-Angle-Camera-WiFi-FPV-RC-Dron-Height.jpg_Q90.jpg" alt="User photo 3">
      </div>
    </div>
  </div>

  <div class="reviews-pagination">
    <button class="pagination-btn active">1</button>
    <button class="pagination-btn">2</button>
    <button class="pagination-btn">3</button>
    <button class="pagination-btn">Next</button>
  </div>
</div> 