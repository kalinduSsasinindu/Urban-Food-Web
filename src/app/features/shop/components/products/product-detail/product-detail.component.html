<div class="product-detail-container" *ngIf="!loading && product; else loadingTemplate">
  <div class="product-gallery">
    <div class="main-image">
      <img [src]="product.imgUrls?.[selectedImageIndex] || 'assets/placeholder-image.jpg'" [alt]="product.title">
    </div>
    <div class="thumbnail-carousel" *ngIf="product.imgUrls && product.imgUrls.length > 0">
      <div 
        *ngFor="let img of product.imgUrls; let i = index" 
        class="thumbnail" 
        [class.active]="selectedImageIndex === i"
        (click)="selectImage(i)"
      >
        <img [src]="img" [alt]="product.title + ' thumbnail ' + (i+1)">
      </div>
    </div>
  </div>

  <div class="product-info">
    <div class="product-header">
      <div class="hd-badge" *ngIf="product.productType">{{getProductTypeName(product.productType)}}</div>
      <div class="price-section">
        <div class="price-container">
          <span class="current-price" *ngIf="product.variants && product.variants.length > 0">
            LKR{{(product.variants[0]?.price || 0).toFixed(2)}}
          </span>
        
        </div>
        <div class="tax-info">Tax excluded, add at checkout if applicable : Extra 2% off with coins</div>
      </div>
    </div>

    <h1 class="product-title">{{product.title}}</h1>
    <p class="product-description">{{product.description}}</p>

    <div class="return-policy">
      <div class="policy-item">
        <i class="fas fa-exchange-alt"></i>
        <span>Return&refund policy</span>
        <i class="fas fa-chevron-right"></i>
      </div>
      <div class="policy-item">
        <i class="fas fa-shield-alt"></i>
        <span>Security & Privacy</span>
        <i class="fas fa-chevron-right"></i>
      </div>
    </div>

    <!-- Tags Section -->
    <div class="tags-section" *ngIf="product.tags && product.tags.length > 0">
      <h3>Tags</h3>
      <div class="tags-list">
        <span class="tag" *ngFor="let tag of product.tags">{{tag}}</span>
      </div>
    </div>

    <div class="quantity-section">
      <h3>Quantity</h3>
      <div class="quantity-control">
        <button class="quantity-btn" (click)="decreaseQuantity()">-</button>
        <span class="quantity-value">{{quantity}}</span>
        <button class="quantity-btn" (click)="increaseQuantity()">+</button>
      </div>
      <div class="max-quantity" *ngIf="product.variants && product.variants.length > 0">
        {{product.variants[0]?.availableQuantity || 0}} available
      </div>
    </div>

    <div class="action-buttons">
      <button class="buy-now-btn" (click)="buyNow()">Buy now</button>
      <button class="add-to-cart-btn" (click)="addToCart()">Add to cart</button>
    </div>

    <div class="social-actions">
      <button class="share-btn">
        <i class="fas fa-share-alt"></i>
        <span>Share</span>
      </button>
      <button class="wishlist-btn">
        <i class="far fa-heart"></i>
        <span>Add to wishlist</span>
      </button>
    </div>
  </div>
</div>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading product details...</p>
  </div>
  
  <div class="error-container" *ngIf="error">
    <div class="error-icon">
      <i class="fas fa-exclamation-circle"></i>
    </div>
    <h2>Oops! Something went wrong</h2>
    <p>We couldn't load the product details. Please try again later.</p>
    <button class="retry-btn" (click)="loadProductDetails(productId || '')">Retry</button>
  </div>
</ng-template>